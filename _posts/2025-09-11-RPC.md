---
title: RPC(Remote Procedure Call)
description: RPC
author: gemini
date: 2025-09-11 19:00:00 +09:00
categories: [Unreal]
tags: [RPC]
math: true
mermaid: true
---

#### RPC (Remote Procedure Call)

- RPC란?
	- 호출하는 PC와 실행하는 PC가 달라도 되게끔 해주는 통신 기법

- 언리얼에서 RPC의 용도
	- 게임에 큰 영향을 끼치지 않는 일시적인 효과들에 사용하는 편
	- 주로 코스메틱 (사운드, 파티클 등)에 사용한다
	- 게임에 큰 영향을 끼치는 것들은 프로퍼티 레플리케이션을 사용하는 것이 좋다


- RPC invoked from the server

| Actor ownership    | Not replicated | NutMulticast                   | Server         | Client                        |
| ------------------ | -------------- | ------------------------------ | -------------- | ----------------------------- |
| Client-owned actor | Runs on server | Runs on server and all clients | Runs on server | Runs on actor's owning client |
| Server-owned actor | Runs on server | Runs on server and all clients | Runs on server | Runs on server                |
| Unowned actor      | Runs on server | Runs on server and all clients | Runs on server | Runs on server                |

- RPC invoked from a client

| Actor ownership             | Not replicated          | NutMulticast            | Server         | Client                  |
| --------------------------- | ----------------------- | ----------------------- | -------------- | ----------------------- |
| Owned by invoking client    | Runs on invoking client | Runs on invoking client | Runs on server | Runs on invoking client |
| Owned by a different client | Runs on invoking client | Runs on invoking client | Dropped        | Runs on invoking client |
| Server-owned actor          | Runs on invoking client | Runs on invoking client | Dropped        | Runs on invoking client |
| Unowned actor               | Runs on invoking client | Runs on invoking client | Dropped        | Runs on invoking client |


#### Call과 Invoke

- Call
	- 정적인 의미를 가진다
	- 컴파일 타임에 어떤 함수인지, 호출하는 곳과 실행하는 곳이 정해져야 한다
	- 지금까지 정의했던 일반적인 전역 함수와 멤버 함수가 이에 해당한다
	- 즉, **직접적으로** 함수를 **호출하고 실행**해야 한다 (Direct)

- Invoke
	- 동적인 의미를 가진다
	- 런타임에 어떤 함수인지, 호출하는 곳과 실행하는 곳이 어딘지 정해진다
	- 예를 들어, 함수 포인터, 동적 바인딩, RPC 같은 개념들이 이에 해당한다
	- 즉, **간접적으로** 함수를 **호출하고 실행**해야 한다 (Indirect)
	- RPC도 마찬가리조 **RPC를 Invoke**라고 표현한다


#### Actor Ownership

- 네트워크 멀티플레이가 적용되려면, 액터는 서버에서 스폰되고, `bReplicated`가 `true`여아 한다
- 서버에서 스폰된 후 `SetOwner(PlayerController)` 함수를 호출해야 Client-Owned Actor가 된다

>`PlayerController`가 `Local PlayerController`와 같다면, Client-Owned Actor<br>
>`PlayerController`가 `Local PlayerController`와 다르다면, Owned by different client<br>
>서버에서 스폰되었지만 `Setowner()` 함수 호출이 없으면, Server-Owned Actor
{: .prompt-info}


#### NetMulticast, Server, Client

- `UFUNCTION()` 매크로와 함께 사용되는 키워드들
- 키워드는 "해당 원격 PC에서 RPC를 실행시켜 달라는 요청"을 뜻한다

>NetMulticast<br>
>"서버를 포함한 모든 클라이언트에서 해당 RPC를 실행시켜주세요"라는 요청<br>
{: .prompt-info}

>Server<br>
>"서버에서 해당 RPC를 실행시켜주세요"라는 요청
{: .prompt-info}

>Client<br>
>"클라이언트에서 해당 RPC를 실행시켜주세요"라는 요청<br>
{: .prompt-info}


#### 자주 쓰이는 케이스

1. RPC가 클라이언트에서 호출되고 서버에서 실행되어야 하는 경우에는 `Server` 키워드를 사용해야 한다
	- `ClientConnection`이 소유하고 있는 액터 (Client-Owned)에서 RPC가 호출되어야 한다
	- `_Validate()` 함수에서 RPC를 실행할지 말지를 결정한다

2. RPC가 서버와 모든 클라이언트에서 실행되어야 하는 경우에는 `NetMulticast` 키워드를 사용해야 한다
	- 서버에서 호출해야 한다
	- 부하가 심하므로, 빈번하게 호출되게끔 코드를 작성하는 건 권장되지 않는다
		- ex) Tick() 함수 내에서 NetMulticast RPC 호출

3. RPC가 서버에서 호출되고 클라이언트에서 실행되어야 하는 경우에는 `Client` 키워드를 사용해야 한다
	- 서버에서 호출해야 한다


#### WithValidation

- `UFUNCTION()` 매크로와 함께 사용되는 키워드
- 서버에서 실행되는 RPC의 경우에 해당 키워드를 작성하는 것이 권장
- 이 키워드가 붙은 RPC를 구현할 때는 `Implementation()` 함수와 `_Validate()` 함수로 나뉘어 진다
- `_Validate()` 함수는 해당 RPC가 서버에서 실제로 실행할지 말지 결정한다
- 서버 실행 로직은 무조건적으로 신뢰되기 때문에, 위변조를 막기 위한 방어막 역할을 한다


#### Unreliable VS Reliable

- `UFUNCTION()` 매크로와 함께 사용되는 키워드
- RPC는 기본적으로 **Unreliable** 키워드를 기준으로 동작. 아무것도 안쓰면 Unreliable
- **Unreliable**은 원격 PC에서 무조건 실행되리라는 보장이 없다
- 반면, 원격 PC에서 무조건 실행되어야 하는 로직이라면 Reliable 키워드를 작성한다

>Unreliable의 활용 예시<br>
>코스메틱(이펙트, 사운드 등)처럼 게임에 큰 영향이 없는 로직
{: .prompt-info}

>Reliable의 활용 예시<br>
>충돌, 데미지, 스폰처럼 게임에 큰 영향을 끼치는 로직
{: .prompt-info}